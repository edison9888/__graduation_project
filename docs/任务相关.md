任务相关说明
==========

## 基本说明 ##
任务分为两层，第一层是任务，第二层是细分的任务的行动。
比如：支线任务T231《竞技勇者》，整个任务为一个整体，是第一层，然后里面的行动都属于第二层（“击败竞技之王“，”与罗宾对话“）。
游戏中显示的是第二层的内容。

## 任务结构 ##
- category    *任务类型*
- name        *任务名称*
- description *任务描述*
- bonus       *任务奖励*
- content     *任务内容*

### 任务内容 ###
根据任务行动分类的不同，内容也不同。
**action**是必定会有的字段，其它内容根据此字段的不同而不同。
**description**则描述次子任务的的内容，可有可无。

## 任务类型 ##
任务划分为以下几种类型(action)：

- move    *移动到某个区域*
- talk    *与某人谈话*
- get     *从某人处获得某物*
- give    *给予某人某物*
- hunt    *击杀/击败某人/某物*
- collect *收集/拯救某物/某人*
- event   *发生事件*
- flag    *标志更改*

#### action取值 ####
- move *移动到某个区域或者坐标*<br>
    其余取值：
    - map *地图ID*
    - x *地图中的x坐标*
    - y *地图中的y坐标*
    - w *区域宽度*
    - h *区域高度*

- talk *和某人谈话*<br>
    其余取值：
    - id *要对话的人物的ID*

- get *获取物品*<br>
    其余取值：
    - id *NPC的ID*
    - items *物品的字典，key为物品的ID，value为物品的数量*

- give *给予某人物品*<br>
    其余取值：
    - id *需要给予的NPC的ID*
    - items *物品的字典，key为物品的ID，value为物品的数量*

- hunt *需要干掉的人或者怪物*<br>
    其余取值：
    - targets *目标的字典，key为目标的ID，value为目标的数量*

- collect *需要收集/拯救的某物或者人*<br>
    其余取值：
    - targets *目标的字典，key为目标的ID，value为目标的数量*
    
- event *发生事件*<br>
    其余取值：
    - script *脚本文件路径*
    
- flag *标志更改*<br>
    其余取值：
    - flags *标志的字典，key为标志的ID，value为标志的状态，标志的状态允许值为***on***、***off***、***invalid***，若出现其他值，当做***invalid***处理*
    
### 一个任务结构文件的例子 ###
	{
		"T101" : {
			"category": 1,
			"name": "xxxx",
			"description": "null",
			"bonus": [
				"0001"
			],
			"content": [
				{
					"action": "move",
					"description": "go to",
					"map": "M001",
					"x": 20,
					"y": 20,
					"w": 1,
					"h": 1
				},
				{
					"action": "talk",
					"description": "talk with",
					"id": "N001"
				},
				{
					"action": "get",
					"description": "get from",
					"id": "N002",
					"items": { 
						"I001": 1, 
						"I002": 2
					}
				},
				{
					"action": "give",
					"description": "give",
					"id": "N003",
					"items": { 
						"I001": 1, 
						"I002": 2
					}
				},
				{
					"action": "hunt",
					"description": "hunt 10",
					"targets": { 
						"M001": 10
					}
				},
				{
					"action": "collection",
					"description": "need 10",
					"targets": { 
						"I010": 10
					}
				},
				{
					"action": "event",
					"script": "a.lua"
				}
			]
		}
	}
	
## 任务状态保存 ##
每个任务状态至少有一个字段**progress**，值类型为数字，表示已完成的子任务数。
其中，*give*、*hunt*、*collect*类型的子任务有附加的字段，如下：

   action  |   字段   |                      解释
 --------- | ------- | -------------------------------------------------------
    give   |  items  | 已给予的物品的字典，key为物品的ID，value为物品剩余需要给予的数量
    hunt   | targets | 已完成狩猎的目标的字典，key为目标的ID，value为目标的完成数量
collection | targets | 已完成收集/拯救目标的字典，key为目标的ID，value为目标的完成数量
    
### 一个任务状态文件的例子 ###
*这个状态实际上不是单独的保存出来的一个文件，而是和存档储存在一起。*<br>
**T001**的子任务数一共有4个，所以下面表示的T001已经完成。<br>
**T101**的子任务已完成了1个，现在处于第2个子任务中，并且子任务是give类型(查询任务资料得知)，物品I001还需要给予1个。<br>
**T201**的子任务已完成了2个，现在处于第3个子任务中，并且子任务是collect类型(查询任务资料得知)，物品I001已经获得1个。

    {
        "T001": {
            "progress": 4
        },
        "T101": {
            "progress": 1,
            "items": {
                "I001": 1
            }
        }
        "T201": {
            "progress": 2,
            "targets": {
                "I001": 1
            }
        }
    }

## 杂谈 ##
关于任务的条件，除了配置的flag之外，若果NPC有提供选择，则作为附带flag

## 随想 ##
任务配置由任务编辑器来配置。触发由NPC对话触负责。

### 配置任务 ###
0. 在任务编辑器添加一个任务
1. 在场景编辑器设置触发器
